<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit {{ recipe.title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .category-badge {
      padding: 0.35em 0.65em;
      border-radius: 0.35rem;
      color: white;
      font-weight: 500;
      font-size: 0.9rem;
    }
    .main { background-color: #007bff; }
    .side { background-color: #28a745; }
    .dessert { background-color: #dc3545; }
    .drink { background-color: #17a2b8; }
    .uncategorized { background-color: #6c757d; }
    .form-section { margin-bottom: 2rem; }
    .form-section label { font-weight: 600; }
  </style>
</head>
<body>
  
<div class="container my-5">
  <h1 class="mb-4">Edit Recipe: {{ recipe.title }}</h1>
  <span class="badge category-badge {{ recipe.category|lower|replace(' ', '-') }}">
    {{ recipe.category }}
  </span>

  <form method="POST" id="edit-recipe-form">
    <div class="form-section">
      <label for="title">Title</label>
      <input type="text" name="title" id="title" class="form-control" value="{{ recipe.title }}" required>
    </div>

    <div class="form-section">
      <label for="ingredients">Ingredients (comma separated)</label>
      <input type="text" name="ingredients" id="ingredients" class="form-control" 
             value="{{ recipe.ingredients | join(', ') }}" required>
    </div>

    <div class="form-section">
      <label for="instructions">Instructions</label>
      <textarea name="instructions" id="instructions" class="form-control" rows="6" required>{{ recipe.instructions }}</textarea>
    </div>

    <div class="form-section">
      <label for="category">Category</label>
      <select name="category" id="category" class="form-select" required>
        {% set cats = ['main','side','dessert','drink','uncategorized'] %}
        {% for cat in cats %}
          <option value="{{ cat }}" {% if recipe.category|lower == cat %}selected{% endif %}>{{ cat.capitalize() }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="form-section">
      <label for="source">Source (URL or text)</label>
      <input type="text" name="source" id="source" class="form-control" value="{{ recipe.source }}">
    </div>
  </form>
  <div class="mt-4 d-flex gap-3">
    <button type="submit" form="edit-recipe-form" class="btn btn-success">Save Changes</button>

    <a href="{{ url_for('view_recipe', rid=recipe.id) }}" class="btn btn-secondary">Back to Recipe</a>
    
{% if session.admin_logged_in %}
    <form action="{{ url_for('delete_recipe', rid=recipe.id) }}"
          method="POST"
          onsubmit="return confirm('Are you sure you want to delete this recipe?');"
          style="display:inline;">
        <button class="btn btn-danger">Delete Recipe</button>
    </form>
{% endif %}
</div>
</div>
</body>
</html>
